%% Gamma calibration

steps = 17;
run_gamma_flashes_OLED('linear', steps, [0 0 1]); % FIRST PARAMETER will reset gamma to linear!

% linear measurements (INSERT HERE)
r = [21.200 25.130 17.023 29.540 12.947 34.023 8.875 38.690 4.446 43.715 0.235 48.637 0.090 53.635 0.087 58.442 0.085];
g = [34.181 40.820 27.342 48.172 20.780 55.804 14.386 63.750 7.945 72.415 0.787 80.920 0.096 89.740 0.086 98.147 0.084];
b = [18.333 21.890 14.616 25.847 11.057 29.961 7.593 34.245 3.967 38.917 0.241 43.573 0.089 48.361 0.085 52.982 0.084];
% w = [];

[~,i] = sort(get_sequence(steps));
r = r(i);
g = g(i);
b = b(i);
% w = w(i);

[scale, power, offset] = fit_gamma_OLED([r',g',b']);

% control
run_gamma_flashes_OLED([scale, power, offset], steps, [1 1 1]);

% corrected measurements (INSERT HERE, then proceed below)
r = [30.112 33.511 26.536 37.319 22.770 40.870 18.809 44.203 14.913 47.872 10.540 51.337 5.402 54.830 0.170 58.167 0.092];
g = [50.560 56.357 43.910 62.282 37.971 67.891 31.386 74.146 24.614 80.067 17.710 86.115 10.085 91.743 0.645 98.012 0.093];
b = [27.167 30.288 23.840 33.503 20.414 36.852 17.071 39.951 13.413 43.167 9.645 46.436 5.445 49.761 0.221 52.846 0.092];
w = [109.03 121.390 96.218 134.072 83.404 146.17 69.801 158.57 55.767 171.09 40.877 183.37 24.272 195.51 2.132 207.73 0.099];

r = r(i);
g = g(i);
b = b(i);
w = w(i);
% plot
x = linspace(0,255,steps);
figure
subplot(1,2,1); plot(x, r, 'r', x, g, 'g', x, b, 'b');
subplot(1,2,2); plot(x, w, 'k-o', x, r+g+b, 'm-*'); legend('measured', 'sum')
